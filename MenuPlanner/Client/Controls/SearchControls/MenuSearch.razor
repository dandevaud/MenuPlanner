@using MenuPlanner.Shared.models
@using MenuPlanner.Shared.models.enums
@using MenuPlanner.Shared.models.Search
@using MenuPlanner.Client.Controls.SearchControls
@inject PublicClient PublicClient

<EditForm Model="searchModel" OnValidSubmit="@GetMenus">
    <fieldset>
        <div class="row g-3 m-3 form-group">
            <div class="col col-9">
                <input type="search" @bind="searchString" id="menuSearch" class="form-control m-0" placeholder="Search" />

            </div>
            <div class="col col-1">
                <button type="submit" class="btn btn-primary form-control m-0">
                    <i class="fas fa-search"></i>
                </button>
            </div>
            <div class="col col-2">
                @if (isAdvanced)
                {
                    <select @onchange="() => isAnyMatch = !isAnyMatch" class="form-control">
                        <option value=true selected>Any Match</option>
                        <option value=false>By Name</option>
                    </select>
                }
                else
                {
                    <div class="btn-group" role="group">
                        <button class="btn btn-primary" @onclick="@ChangeAdvanced" type="button">Advanced</button>
                        <button class="btn btn-secondary" @onclick="Reset" type="reset"><i class="fa fa-redo" /></button>
                    </div>
                }
            </div>
        </div>
        <div class="row m-4 form-group" hidden="@(!isAdvanced)">
            <label for="ingredient">Ingredient</label>
            <div id="ingredient" class="form-control" style="min-height: 40px">
                @foreach (var ingredient in searchModel.Ingredients)
                {
                    <div class="alert alert-secondary alert-dismissible d-inline number m-1 p-1">
                        @ingredient.Name <i class="fa fa-window-close ml-1" @onclick="() => RemoveIngredient(ingredient)"></i>
                    </div>
                }
            </div>
            <IngredientSearch InputClass="form-control" DivClass="px-0" Ingredient="ing" IngredientChanged="AddToIngredientList"></IngredientSearch>
        </div>
        <div class="row m-4 form-group" hidden=@(!isAdvanced)>
            <EnumSearchControl Id="TimeOfDay" Text="Time of Day" TEnum="TimeOfDay" StandardValue="TimeOfDay.Unknown" GetActiveAttribute="@((TimeOfDay e) => GetActiveAttribute(e))" UpdateEnumValues="@((TimeOfDay e) => selectedEnums.UpdateValues(e))"></EnumSearchControl>

            <EnumSearchControl Id="Season" Text="Season" TEnum="Season" StandardValue="Season.Unknown" GetActiveAttribute="@((Season e) => GetActiveAttribute(e))" UpdateEnumValues="@((Season e) => selectedEnums.UpdateValues(e))"></EnumSearchControl>

            <EnumSearchControl Id="MenuCategory" Text="Menu Category" TEnum="MenuCategory" StandardValue="MenuCategory.Unknown" GetActiveAttribute="@((MenuCategory e) => GetActiveAttribute(e))" UpdateEnumValues="@((MenuCategory e) => selectedEnums.UpdateValues(e))"></EnumSearchControl>

            <EnumSearchControl Id="Diet" Text="Diet" TEnum="Diet" StandardValue="Diet.None" GetActiveAttribute="@((Diet e) => GetActiveAttribute(e))" UpdateEnumValues="@((Diet e) => selectedEnums.UpdateValues(e))"></EnumSearchControl>

        </div>

        <div class="row m-4 form-group" hidden=@(!isAdvanced)>
            <div class="col-md-4">
                <label for="prepTime">Preparation Time in minute</label>
                <input type="range" class="form-range d-inline" min="0" max="@maxValues.GetValueOrDefault("prepTime")" id="prepTime" @bind="searchModel.PrepTime" /><InputNumber @bind-Value="@searchModel.PrepTime" min="0" max="@maxValues.GetValueOrDefault("prepTime")" class="d-inline"></InputNumber>
            </div>
            <div class="col-md-4">
                <label for="cookTime">Cook Time in minute</label>
                <label>@searchModel.CookTime min</label>
                <input type="range" class="form-range" min="0" max="@maxValues.GetValueOrDefault("cookTime")" id="cookTime" @bind="searchModel.CookTime" /><InputNumber @bind-Value="@searchModel.CookTime" min="0" max="@maxValues.GetValueOrDefault("cookTime")" class="d-inline"></InputNumber>
            </div>
            <div class="col-md-4">
                <TimeSlider Text="Total time in minutes" FieldId="totalTime" MaxValues="maxValues" @bind-Value="searchModel.TotalTime"></TimeSlider>
            </div>
        </div>

        <div class="row" hidden=@(!isAdvanced)>
            <div class="col col-6"></div>
            <div class="col col-6 btn-group" role="group">
                <button class="btn btn-secondary" @onclick="@Reset" type="reset"><i class="fa fa-redo" /> Reset</button>
                <button class="btn btn-danger" @onclick="@ChangeAdvanced" type="button"><i class="fa fa-times-circle" /> Close</button>
                <button class="btn btn-success" type="submit"><i class="fa fa-search" /> Search</button>
            </div>
        </div>
    </fieldset>
</EditForm>

